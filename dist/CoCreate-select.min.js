!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.select=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.select=t())}(this,function(){return a={},l.m=n=[function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";n.r(t);var i={init:function(){this.initElement()},initElement:function(e){e=e||document;if(e.querySelectorAll)for(var t=e.querySelectorAll("cocreate-select, div.select--field"),n=0;n<t.length;n++){var a=t[n];this.__initSelect(a)}},__initEvents:function(){var n=this;document.addEventListener("dndsuccess",function(e){var t=e.detail,e=t.dropedEl;t.dragedEl;(void 0!==e.tagName&&"cocreate-select"==e.tagName.toLowerCase()||e.classList.contains("select--field"))&&(n.save(e),n.__fireSelectedEvent(e))})},__initSelect:function(a){var e,t,l;CoCreate.observer.getInitialized(a,"cocreate-select")||(CoCreate.observer.setInitialized(a,"cocreate-select"),e=a.querySelector("input"),t=a.querySelector("ul.selectable--list"),l=this,e&&e.addEventListener("keydown",function(e){var t=e.keyCode;13==t&&e.preventDefault(),13==t&&0<this.value.length?(l.__selectValue(this.value,a),l.save(a),l.__fireSelectedEvent(a),this.value=""):8!=t||this.value.length||0<(t=a.querySelectorAll("[selected]")).length&&(t[t.length-1].remove(),l.save(a),l.__fireSelectedEvent(a))}),document.addEventListener("click",function(e){a.contains(e.target)||l.__closeDropDown(a)}),t.addEventListener("click",function(e){if(!e.target.matches("li")){for(var t,n=e.target;void 0!==n.tagName&&"li"!=n.tagName.toLowerCase();)n=n.parentNode;n.classList&&n.classList.contains("selectable")&&((t=n.getAttribute("value"))==(e=l.getValue(a))||-1<e.indexOf(t)||(l.__selectItem(n,a),l.save(a),l.__fireSelectedEvent(a)))}}),a.addEventListener("click",function(e){if(e.target.matches(".remove"))return e.target.parentNode.remove(),l.save(a),void l.__fireSelectedEvent(a);t.classList.contains("open")||l.__openDropDown(a);e=a.querySelector("input");e&&e.focus()},!0))},__openDropDown:function(e){var t,n;1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||(t=e.querySelector("input"),n=e.querySelector("ul.selectable--list"),t&&(t.classList.add("open"),t.focus()),n&&n&&n.classList.add("open"),e.dispatchEvent(new CustomEvent("CoCreateSelect-open")))},__closeDropDown:function(e){var t=e.querySelector("input"),n=e.querySelector("ul.selectable--list");t&&t.classList.contains("open")&&t.classList.remove("open"),n&&n.classList.contains("open")&&(n.classList.remove("open"),e.dispatchEvent(new CustomEvent("CoCreateSelect-close")))},setValue:function(l){var r=this;document.querySelectorAll("cocreate-select,.select--field").forEach(function(e){var t=e.getAttribute("data-collection")||"module_activity",n=e.getAttribute("data-document_id"),a=e.getAttribute("name");l.collection==t&&l.document_id==n&&a&&r.__renderValue(e,l.data[a])})},renderValue:function(e,t){this.__renderValue(e,t)},__renderValue:function(e,t){if(t){e.querySelectorAll("[selected]").forEach(function(e){return e.remove()});var n=e.querySelector("ul.selectable--list");t&&"string"==typeof t&&(t=[t]);for(var a=0;a<t.length;a++){var l=n.querySelector("li[value='"+t[a]+"']");l?this.__selectItem(l,e,!1):this.__selectValue(t[a],e,!1)}try{CoCreateFloatLabel&&CoCreateFloatLabel.update(e,t&&0<t.length)}catch(e){}}},__selectValue:function(e,t){var n,a,l,r=this.getValue(t);r==e||-1<r.indexOf(e)||(n=t.querySelector("input"),a=t.querySelector("ul.selectable--list"),(l=document.createElement("span")).innerHTML="x",l.classList.add("remove"),(r=document.createElement("li")).setAttribute("value",e),r.innerHTML=e,r.setAttribute("selected",""),r.classList.remove("selectable"),r.appendChild(l),t.insertBefore(r,n||a))},__selectItem:function(e,t){var n=t.hasAttribute("multiple")?"multiple":"single",a=t.querySelector("input"),l=t.querySelector("ul.selectable--list");"single"==n&&(t.querySelectorAll("[selected]").forEach(function(e){return e.remove()}),a&&(a.value=""));var r=document.createElement("span");r.innerHTML="x",r.classList.add("remove");e=e.cloneNode(!0);e.setAttribute("selected",""),e.classList.remove("selectable"),e.appendChild(r),t.insertBefore(e,a||l),"single"==n&&this.__closeDropDown(t)},getValue:function(e){var t=e.hasAttribute("multiple")?"multiple":"single",e=e.querySelectorAll("[selected]"),n=[];return 0<e.length&&e.forEach(function(e){return n.push(e.getAttribute("value"))}),n="multiple"==t?n:n[0]||""},save:function(e){e&&(e=new CustomEvent("CoCreateSelect-save",{detail:{element:e}}),document.dispatchEvent(e))},__fireSelectedEvent:function(e){e.dispatchEvent(new CustomEvent("selectedValue")),e.dispatchEvent(new CustomEvent("input",{bubbles:!0}));var t=this.getValue(e);document.dispatchEvent(new CustomEvent("CoCreate-selected",{detail:{element:e,value:t}}))}},a=n(0),o=n.n(a),l={init:function(){this.initElement(),this.__initEvents()},initElement:function(e){e=e||document;if(e.querySelectorAll)for(var t=e.querySelectorAll("cocreate-select, div.select--field"),n=0;n<t.length;n++)i.__initSelect(t[n]),this.__initElementEvent(t[n])},__initEvents:function(){var n=this;document.addEventListener("dndsuccess",function(e){var t=e.detail,e=t.dropedEl;t.dragedEl;(void 0!==e.tagName&&"cocreate-select"==e.tagName.toLowerCase()||e.classList.contains("select--field"))&&(n.save(e),e.dispatchEvent(new CustomEvent("selectedValue")))}),document.addEventListener("CoCreateSelect-save",function(e){e=e.detail.element;e&&n.save(e)}),CoCreate.socket.listen("readDocument",function(e){"cocreate-select"==e.metadata&&i.setValue(e)}),CoCreate.socket.listen("updateDocument",function(e){"cocreate-select"==e.metadata&&i.setValue(e)}),document.addEventListener("CoCreate-selected",function(e){var t=e.detail;t.element,t.value;console.log(e.detail)})},__initElementEvent:function(e){var t=this;e.addEventListener("set-document_id",function(){t.save(this)});var n=e.getAttribute("data-collection")||"module_activity",e=e.getAttribute("data-document_id");n&&e&&CoCreate.crud.readDocument({collection:n,document_id:e,metadata:"cocreate-select"})},__sendRequest:function(e){var t=e.getAttribute("data-collection")||"module_activity",e=e.getAttribute("data-document_id");t&&e&&CoCreate.crud.readDocument({collection:t,document_id:e,metadata:"cocreate-select"})},save:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=i.getValue(e),a=e.getAttribute("data-collection")||"module_activity",l=e.getAttribute("data-document_id"),r=e.getAttribute("name"),c=e.getAttribute("data-realtime")||"true";r&&("true"!=c&&!t||"false"==e.getAttribute("data-save_value")||(CoCreate.document_id.checkID(e)?l&&CoCreate.crud.updateDocument({collection:a,document_id:l,data:o()({},r,n),upsert:!0,metadata:"cocreate-select"}):(CoCreate.document_id.request({element:e,value:n,nameAttr:"name"}),e.setAttribute("data-document_id","pending"))))}};l.init(),i.adapter=l,CoCreate.observer.init({name:"CoCreateSelectAttributes",observe:["attributes"],attributes:["data-document_id"],include:"cocreate-select",callback:function(e){l.__sendRequest(e.target)}}),CoCreate.observer.init({name:"CoCreateSelect",observe:["subtree","childList"],include:"cocreate-select",callback:function(e){l.initElement(e.target)}}),CoCreate.form.init({name:"CoCreateSelect",selector:"cocreate-select",callback:function(e){CoCreate.select.adapter.save(e)}});t.default=i}],l.c=a,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(t,e){if(1&e&&(t=l(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)l.d(n,a,function(e){return t[e]}.bind(null,a));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l(l.s=1).default;function l(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,l),t.l=!0,t.exports}var n,a});