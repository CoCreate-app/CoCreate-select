(()=>{var e={init:function(){this.initElement()},initElement:function(e){e=e||document;if(e.querySelectorAll)for(var t=e.querySelectorAll("cocreate-select, div.select--field"),n=0;n<t.length;n++){var l=t[n];this.__initSelect(l)}},__initEvents:function(){var n=this;document.addEventListener("dndsuccess",function(e){var t=e.detail,e=t.dropedEl;t.dragedEl;(void 0!==e.tagName&&"cocreate-select"==e.tagName.toLowerCase()||e.classList.contains("select--field"))&&(n.save(e),e.dispatchEvent(new CustomEvent("selectedValue")),e.dispatchEvent(new CustomEvent("input",{bubbles:!0})))})},__initSelect:function(l){var e,t,s;CoCreateInit.getInitialized(l,"cocreate-select")||(CoCreateInit.setInitialized(l,"cocreate-select"),e=l.querySelector("input"),t=l.querySelector("ul.selectable--list"),s=this,e&&e.addEventListener("keydown",function(e){e=e.keyCode;13==e&&0<this.value.length?(s.__selectValue(this.value,l),s.save(l),l.dispatchEvent(new CustomEvent("selectedValue")),l.dispatchEvent(new CustomEvent("input",{bubbles:!0})),this.value=""):8!=e||this.value.length||0<(e=l.querySelectorAll("[selected]")).length&&(e[e.length-1].remove(),s.save(l),l.dispatchEvent(new CustomEvent("selectedValue")),l.dispatchEvent(new CustomEvent("input",{bubbles:!0})))}),document.addEventListener("click",function(e){l.contains(e.target)||s.__closeDropDown(l)}),t.addEventListener("click",function(e){if(!e.target.matches("li")){for(var t,n=e.target;void 0!==n.tagName&&"li"!=n.tagName.toLowerCase();)n=n.parentNode;n.classList&&n.classList.contains("selectable")&&((t=n.getAttribute("value"))==(e=s.getValue(l))||-1<e.indexOf(t)||(s.__selectItem(n,l),s.save(l),l.dispatchEvent(new CustomEvent("selectedValue")),l.dispatchEvent(new CustomEvent("input",{bubbles:!0}))))}}),l.addEventListener("click",function(e){if(e.target.matches(".remove"))return e.target.parentNode.remove(),s.save(l),l.dispatchEvent(new CustomEvent("selectedValue")),void l.dispatchEvent(new CustomEvent("input",{bubbles:!0}));t.classList.contains("open")||s.__openDropDown(l);e=l.querySelector("input");e&&e.focus()},!0))},__openDropDown:function(e){var t,n;1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||(t=e.querySelector("input"),n=e.querySelector("ul.selectable--list"),t&&(t.classList.add("open"),t.focus()),n&&n&&n.classList.add("open"),e.dispatchEvent(new CustomEvent("CoCreateSelect-open")))},__closeDropDown:function(e){var t=e.querySelector("input"),n=e.querySelector("ul.selectable--list");t&&t.classList.contains("open")&&t.classList.remove("open"),n&&n.classList.contains("open")&&(n.classList.remove("open"),e.dispatchEvent(new CustomEvent("CoCreateSelect-close")))},setValue:function(s){var i=this;document.querySelectorAll("cocreate-select,.select--field").forEach(function(e){var t=e.getAttribute("data-collection")||"module_activity",n=e.getAttribute("data-document_id"),l=e.getAttribute("name");s.collection==t&&s.document_id==n&&l&&i.__renderValue(e,s.data[l])})},renderValue:function(e,t){this.__renderValue(e,t)},__renderValue:function(e,t){if(t){e.querySelectorAll("[selected]").forEach(function(e){return e.remove()});var n=e.querySelector("ul.selectable--list");t&&"string"==typeof t&&(t=[t]);for(var l=0;l<t.length;l++){var s=n.querySelector("li[value='"+t[l]+"']");s?this.__selectItem(s,e,!1):this.__selectValue(t[l],e,!1)}try{CoCreateFloatLabel&&CoCreateFloatLabel.update(e,t&&0<t.length)}catch(e){}}},__selectValue:function(e,t){var n,l,s,i=this.getValue(t);i==e||-1<i.indexOf(e)||(n=t.querySelector("input"),l=t.querySelector("ul.selectable--list"),(s=document.createElement("span")).innerHTML="x",s.classList.add("remove"),(i=document.createElement("li")).setAttribute("value",e),i.innerHTML=e,i.setAttribute("selected",""),i.classList.remove("selectable"),i.appendChild(s),t.insertBefore(i,n||l))},__selectItem:function(e,t){var n=t.hasAttribute("multiple")?"multiple":"single",l=t.querySelector("input"),s=t.querySelector("ul.selectable--list");"single"==n&&(t.querySelectorAll("[selected]").forEach(function(e){return e.remove()}),l&&(l.value=""));var i=document.createElement("span");i.innerHTML="x",i.classList.add("remove");var a=e.cloneNode(!0);a.setAttribute("selected",""),a.classList.remove("selectable"),a.appendChild(i),t.insertBefore(a,l||s),"single"==n&&this.__closeDropDown(t)},getValue:function(e){var t=e.hasAttribute("multiple")?"multiple":"single",e=e.querySelectorAll("[selected]"),n=[];return 0<e.length&&e.forEach(function(e){return n.push(e.getAttribute("value"))}),n="multiple"==t?n:n[0]||""},save:function(e){e&&(e=new CustomEvent("CoCreateSelect-save",{detail:{element:e}}),document.dispatchEvent(e))}};e.init(),CoCreateInit.register("CoCreateSelect",e,e.initElement)})();