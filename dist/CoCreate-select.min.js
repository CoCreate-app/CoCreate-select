!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CoCreate=e():(t.CoCreate=t.CoCreate||{},t.CoCreate.select=e())}(this,(function(){return(()=>{var t={375:function(t,e,n){var o,i;"undefined"!=typeof self&&self,o=[n(446),n(965)],void 0===(i=function(t,e){return function(t,e,n){return{socket:null,setSocket:function(t){this.socket=t},readDocumentList:async function(t){if(!t)return!1;let n=e.getCommonParams();if(!t.collection)return!1;n={...n,...t},e.generateSocketClient(t.namespace,t.room);const o=this.socket.send("readDocumentList",n);try{return await this.socket.listenAsync(o)}catch(t){return null}},createDocument:async function(n){if(null===n)return!1;let o=e.getCommonParamsExtend(n),i={...n,...o},a=n.data||{};a.organization_id||(a.organization_id=t.config.organization_Id),n.data&&(a={...a,...n.data}),i.data=a;const r=e.generateSocketClient(n.namespace,n.room);let c=this.socket.send("createDocument",i,r);try{return await this.socket.listenAsync(c)}catch(t){return null}},updateDocument:async function(t){if(!t)return!1;if(t.document_id&&!n.checkDocumentId(t.document_id))return!1;let o=e.getCommonParamsExtend(t),i={...t,...o};if("object"==typeof t.data&&(i.set=t.data),Array.isArray(t.delete_fields)&&(i.unset=t.delete_fields),!i.set&&!i.unset)return!1;!1===t.broadcast&&(i.broadcast=!1),void 0===t.broadcast_sender&&(i.broadcast_sender=!0);const a=e.generateSocketClient(t.namespace,t.room);let r=this.socket.send("updateDocument",i,a);try{return await this.socket.listenAsync(r)}catch(t){return null}},readDocument:async function(t){if(null===t)return null;if(!t||!n.checkDocumentId(t.document_id))return null;let o=e.getCommonParamsExtend(t),i={...t,...o},a=this.socket.send("readDocument",i);try{return e.generateSocketClient(t.namespace,t.room),await this.socket.listenAsync(a)}catch(t){return null}},deleteDocument:async function(t){if(!t||!n.checkDocumentId(t.document_id))return null;let o=e.getCommonParamsExtend(t),i={...t,...o};const a=e.generateSocketClient(t.namespace,t.room);let r=this.socket.send("deleteDocument",i,a);try{return await this.socket.listenAsync(r)}catch(t){return null}},exportCollection:function(t){if(null===t)return;let n=e.getCommonParamsExtend(t);n.collection=t.collection,n.export_type=t.export_type,n.metadata=t.metadata,this.socket.send("exportDB",n)},importCollection:function(n){const{file:o}=n;if(null===n||!(o instanceof t.File))return;const i=o.name.split(".").pop();if(!["json","csv"].some((t=>t===i)))return;let a=e.getCommonParamsExtend(n);a.collection=n.collection,a.import_type=i,this.socket.send("importDB",a),this.socket.sendFile(o)},listen:function(t,e){this.socket.listen(t,e)},listenAsync:function(t){return this.socket.listenAsync(t)},createSocket:function(t,e){e?(this.socket.create({namespace:e,room:null,host:t}),this.socket.setGlobalScope(e)):this.socket.create({namespace:null,room:null,host:t})},read:async function(t,e){const{collection:o,document_id:i,name:a,namespace:r,room:c,is_read:s}=n.getAttr(t);if(!n.checkAttrValue(i))return!1!==e&&(e=!0),n.isJsonString(o)||n.isJsonString(i)?null:i&&o&&s?await this.readDocument({namespace:r,room:c,collection:o,document_id:i,name:a,is_flat:e}):null},save:async function(t){if(t)for(let e=0;e<t.length;e++)await this.saveElement(t[e])},saveElement:async function({element:e,value:o,is_flat:i}){if(!e||null===o)return;const{collection:a,document_id:r,name:c,namespace:s,room:l,broadcast:u,broadcast_sender:d,is_save:f}=n.getAttr(e);if(f&&a&&c)if(n.isCRDT(e)&&t.CoCreate.crdt)t.CoCreate.crdt.replaceText({collection:a,name:c,document_id:r,name:c,value:o});else{let t=await this.updateDocument({namespace:s,room:l,collection:a,document_id:r,upsert:!0,broadcast:u,broadcast_sender:d,is_flat:!1!==i,data:{[c]:o}});t.document_id&&r!==t.document_id&&await this.setDocumentId({element:e,docuement_id:t.document_id})}},setDocumentId:async function({element:t,form:e,document_id:n}){!e&&t&&(e=t.closest("form")),e?await CoCreate.form.setDocumentId(e):t&&t.setAttribute("data-document_id",n)},...n}}(window,t,e)}.apply(e,o))||(t.exports=i)},611:function(t,e,n){var o,i;"undefined"!=typeof self&&self,o=[n(585),n(375)],void 0===(i=function(t,e){return function(t,e,n){if(t){let t=window.CoCreateCrudSocket;t||(t=new e("ws"),window.CoCreateCrudSocket=t),n.setSocket(t),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,t,e)}.apply(e,o))||(t.exports=i)},965:function(t,e){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(){function t(e,n){e=e||{};for(let o of Object.keys(n))n[o]instanceof Object&&Object.assign(n[o],t(e[o],n[o]));return Object.assign(e||{},n),e}function e(t,e){if(!e)return t;let n=e.split("."),o=t;for(var i=n.length-1;i>=0;i--)o={[n[i]]:o};return o}function n(t,e){try{let n=/([\w\W]+)\[(\d+)\]/gm.exec(t);if(n&&3==n.length){let o=n[1],i=parseInt(n[2]);e[o]&&Array.isArray(e[o])||(e[o]=[]),e[o][i]=e[t],delete e[t],t=o}}catch{}return t}function o(t,e){try{if(!t||!e)return null;if(e[t])return e[t];let o=t.split("."),i={...e};for(var n=0;n<o.length&&i;n++)i=i[o[n]];return i}catch{return null}}function i(t){return!!t&&t.constructor===Object}function a(t){return!!t&&t.constructor===Array}function r(o){let i=Object.keys(o),a={};return i.forEach((i=>{if((i=n(i,o)).split(".").length>1){let n=e(o[i],i);delete o[i],a=t(a,n)}else a[i]=o[i]})),a}function c(t){let e=Object.keys(t),n={};return e.forEach((e=>{let o=t[e];if(i(t[e])){let o=c(t[e]);Object.keys(o).forEach((t=>{let i=o[t];n[t=e+"."+t]=i}))}else a(o)?o.forEach(((t,o)=>{n[`${e}[${o}]`]=t})):n[e]=t[e]})),n}function s(t){if(!t)return;let e=t.getAttribute("data-collection"),n=t.getAttribute("data-document_id"),o=t.getAttribute("name"),i=t.getAttribute("data-room");return{collection:e,document_id:n,name:o,is_realtime:m(t),is_save:u(t),is_read:l(t),is_update:d(t),is_listen:p(t),broadcast:f(t),broadcast_sender:h(t),room:i}}const l=t=>g(t,"data-read_value"),u=t=>g(t,"data-save_value"),d=t=>g(t,"data-update_value"),f=t=>g(t,"data-broadcast"),h=t=>g(t,"data-broadcast_sender"),p=t=>g(t,"data-listen"),m=t=>g(t,"data-realtime");function g(t,e){return!!t&&"false"!==t.getAttribute(e)}function b(t){return!!t&&!/{{\s*([\w\W]+)\s*}}/g.test(t)&&"null"!==t.toLowerCase()}function v(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e}catch(t){return!1}}function y(t){const{collection:e,document_id:n,name:o}=s(t);return!(v(e)||v(o)||!("INPUT"===t.tagName&&["text","email","tel","url"].includes(t.type)||"TEXTAREA"===t.tagName)||!o||!m(t)||"true"===t.getAttribute("data-unique")||"password"===t.type||!l(t))}function _(t){try{return!!t&&"null"!==t.toLowerCase()}catch(t){return!1}}function v(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e}catch(t){return!1}}return{decodeObject:r,encodeObject:c,getAttr:s,isRealtimeAttr:m,isReadAttr:l,isSaveAttr:u,isUpdateAttr:d,isFlatAttr:t=>g(t,"data-flat"),checkAttrValue:b,isCRDT:y,checkDocumentId:_,getValueByPath:o,isJsonString:v}}()}.apply(e,[]))||(t.exports=n)},536:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>u});var o=n(366),i=n(611),a=n.n(i);const r={attribute:"data-actions",actions:{},selectedStage:[],stageIndex:0,selectedElement:null,completedEventName:"completedEvent",__init:function(){this.actionButtonEvent()},actionButtonEvent:function(){const t=this;document.addEventListener("click",(function(e){let n=e.target;if(n.getAttribute("data-actions")||(n=e.target.closest("[data-actions]")),!n)return;e.preventDefault();let o=(n.getAttribute(t.attribute)||"").replace(/\s/g,"").split(",");0!=o.length&&(t.stageIndex=0,t.selectedStage=o,t.selectedElement=n,t.__runActionFunc())}))},init:function({action:t,callback:e,endEvent:n}){this.registerEvent(t,e,null,n)},registerEvent:function(t,e,n,o){if(this.actions[t])return;this.actions[t]={key:t,runFunc:e,instance:n||window,endEvent:o};for(let e in this.actions)if(e!=t&&this.actions[e].endEvent===o)return;const i=this;document.addEventListener(o,(function(t){i.__nextAction(o,t.detail)}))},__runActionFunc:function(t){if(this.stageIndex>=this.selectedStage.length)return void(this.stageIndex==this.selectedStage.length&&this.__runAtag(this.selectedElement));const e=this.selectedStage[this.stageIndex],n=this.actions[e];if(n)n.runFunc?n.runFunc.call(null,this.selectedElement,t):this.__nextAction(n.endEvent,{});else{"next"===this.__runSpecialAction(e,t)&&this.__moveNextAction()}},__nextAction:function(t,e){const n=this.selectedStage[this.stageIndex];n&&t===this.actions[n].endEvent&&this.__moveNextAction(e)},__runAtag:function(t){t.querySelector("a")},__runSpecialAction:function(t,e){let n=/(\w+)\{([a-zA-Z0-9_ \-#$.]+)\}/gm.exec(t);if(!n||n.length<3)return"next";let o=n[1],i=n[2].trim();if(!i)return"next";const a=this;switch(o){case"event":document.addEventListener(i,(t=>{a.__moveNextAction(t)}),{once:!0});break;case"timeout":parseInt(i)>0&&setTimeout((function(){a.__moveNextAction(e)}),parseInt(i));break;case"action":let t=document.querySelector(i);t&&t.click();break;default:return"next"}},__moveNextAction:function(t){this.stageIndex++,this.__runActionFunc(t)}};r.__init();const c=r,s={disableAutoFill:function(t){"TEXTAREA"==t.tagName&&(t.value="",t.setAttribute("autocomplete","off")),t.hasAttribute("autocomplete")||t.setAttribute("autocomplete","off")},setAttribute:function(t){const{collection:e,document_id:n,name:o}=a().getAttr(t),i=t.getAttribute("data-realtime"),r=t.getAttribute("data-flat");t.querySelectorAll("[name], [data-pass_to]").forEach((function(t){t.parentNode.classList.contains("template")||(null==t.getAttribute("data-realtime")&&i&&t.setAttribute("data-realtime",i),t.getAttribute("name")&&!t.hasAttribute("data-collection")&&e&&t.setAttribute("data-collection",e),t.getAttribute("data-pass_to")&&!t.hasAttribute("data-pass_collection")&&e&&t.setAttribute("data-pass_collection",e),t.getAttribute("name")&&!t.getAttribute("data-document_id")&&n&&t.setAttribute("data-document_id",n),t.hasAttribute("data-document_id")||null==n||t.setAttribute("data-document_id",n),t.hasAttribute("data-flat")||null==r||t.setAttribute("data-flat",r))}))},checkFormValidate:function(t){return void 0===CoCreate.unique||CoCreate.unique.checkValidate(t)},isTemplateInput:function(t){if(t.classList.contains("template"))return!0;let e=t.parentNode;for(;e;){if(e.classList&&e.classList.contains("template"))return!0;e=e.parentNode}return!1},getFormData:function(t,e,n){let o={};if(!n)return{};return t.querySelectorAll(`[name][data-collection='${n}']`).forEach((t=>{let n=t.getAttribute("data-document_id")||"",i=t.getAttribute("name"),a=t.value||t.getAttribute("value");"_id"!==i&&i&&a&&e==n&&(o[i]=t.value)})),o},getCOllections:function(t){let e=[];return t?(t.querySelectorAll("[name][data-collection]").forEach((t=>{let n=t.getAttribute("data-collection");n&&!e.includes(n)&&e.push(n)})),e):e}},l={requestAttr:"data-document_request",modules:[],init:function({name:t,selector:e,callback:n}){this.modules.push({name:t,callback:n})},checkID:function(t,e="data-document_id"){let n=t.getAttribute(e)||"";return!(""===n||!a().checkAttrValue(n))},initElement:function(t){const e=t||document;if(!e.querySelectorAll)return;let n=e.querySelectorAll("form");0===n.length&&e!=document&&"FORM"===e.tagName&&(n=[e]),n.forEach((t=>{s.setAttribute(t),s.disableAutoFill(t)}))},__init:function(){document.querySelectorAll("form").forEach((t=>{s.setAttribute(t)}))},__deleteDocumentAction:function(t){const{collection:e,document_id:n}=a().getAttr(t);a().checkAttrValue(e)&&a().checkAttrValue(n)&&(a().deleteDocument({collection:e,document_id:n,metadata:"deleteDocument-action"}),document.dispatchEvent(new CustomEvent("deletedDocument",{detail:{}})))},__deleteDocumentsAction:function(t){const{collection:e,document_id:n}=a().getAttr(t),o=t.getAttribute("data-document_target");if(!o)return;const i=document.querySelectorAll(o);a().checkAttrValue(e)&&(i.forEach((t=>{const n=t.getAttribute("data-document_id");a().checkAttrValue(n)&&a().deleteDocument({collection:e,document_id:n,metadata:""})})),document.dispatchEvent(new CustomEvent("deletedDocuments",{detail:{}})))},__createDocumentAction:function(t){const e=t.closest("form");s.getCOllections(e).forEach((t=>{let n=s.getFormData(e,"",t);0==Object.keys(n).length&&n.constructor===Object||a().checkAttrValue(t)&&(a().createDocument({collection:t,data:n,metadata:"createDocument-action",element:"empty"}),document.dispatchEvent(new CustomEvent("createdDocument",{detail:{}})))}))},__saveDocumentAction:async function(t){const e=t.closest("form");s.checkFormValidate(e)?(await this.__requestDocumentId(e),this.modules.forEach((({callback:t})=>{t.call(null,e)}))):alert("Values are not unique")},__requestDocumentId:async function(t){let e=this,n=t.querySelectorAll("[name], [data-pass_to]"),o=[];for(var i=0;i<n.length;i++){let r=n[i];if(r.parentNode.classList.contains("template"))continue;const c=r.getAttribute("data-collection")||r.getAttribute("data-pass_collection")||"";if(""!==c&&!o.includes(c)&&!e.checkID(r,"data-document_id")&&!e.checkID(r,"data-pass_document_id")){o.push(c);let e=await a().createDocument({collection:c,data:{},metadata:""});e&&this.setDocumentId(t,e)}}},setDocumentId:function(t,e){if(!e.document_id)return;let n=this;const o=e.collection,i=e.document_id;if(t&&i){t.querySelectorAll(`[data-collection=${o}], [data-pass_collection=${o}]`).forEach((function(t){t.hasAttribute("name")&&!n.checkID(t)&&t.setAttribute("data-document_id",i),t.hasAttribute("data-pass_to")&&!n.checkID(t,"data-pass_document_id")&&t.setAttribute("data-pass_document_id",i)}))}}};l.__init(),o.default.init({name:"CoCreateForm",observe:["addedNodes"],callback:t=>"FORM"===t.target.tagName&&l.initElement(t.target)}),c.init({action:"createDocument",endEvent:"createdDocument",callback:(t,e)=>{l.__createDocumentAction(t)}}),c.init({action:"deleteDocument",endEvent:"deletedDocument",callback:(t,e)=>{l.__deleteDocumentAction(t)}}),c.init({action:"deleteDocuments",endEvent:"deletedDocuments",callback:(t,e)=>{CoCreateDocument.__deleteDocumentsAction(t)}}),c.init({action:"saveDocument",endEvent:"savedDocument",callback:(t,e)=>{l.__saveDocumentAction(t)}});const u=l},980:function(t,e,n){var o,i;"undefined"!=typeof self&&self,o=[n(585),n(129)],void 0===(i=function(t,e){return function(t,e,n){if(t){let t=window.CoCreateCrudSocket;if(!t){let t=new e("ws");window.CoCreateCrudSocket=t}n.setSocket(t),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,t,e)}.apply(e,o))||(t.exports=i)},129:function(t,e,n){var o,i;"undefined"!=typeof self&&self,o=[n(446)],void 0===(i=function(t){return function(t,e){return{socket:null,setSocket:function(t){this.socket=t},send:function(t){let n=e.getCommonParams();if(!t||!t.emit)return;n={...n,...t};const o=e.generateSocketClient(t.namespace,t.room);this.socket.send("sendMessage",n,o)},receive:function(t,e){this.socket.listen(t,e)},createSocket:function(t,e){this.socket&&(e?(this.socket.create({namespace:e,room:null,host:t}),this.socket.setGlobalScope(e)):this.socket.create({namespace:null,room:null,host:t}))},listen:function(t,e){this.socket.listen(t,e)},listenAsync:function(t){return this.socket.listenAsync(t)}}}(window,t)}.apply(e,o))||(t.exports=i)},366:(t,e,n)=>{"use strict";function o(t){this.callbackMap=new Map,this.callbackMap.set("ALL",{attributes:[],addedNodes:[],removedNodes:[],characterData:[],childList:[]});let[e,n]=this.runCallbackGen("attributes");this.runCallbackAtt=e,this.runCallbackAttAll=n,[e,n]=this.runCallbackGen("characterData"),this.runCallbackChar=e,this.runCallbackCharAll=n,this.runCallbackAdd=this.runCallbackExGen("addedNodes","addedNodes"),this.runCallbackRemove=this.runCallbackExGen("removedNodes","removedNodes");new MutationObserver((t=>this._callback.call(this,t))).observe(t,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0})}n.r(e),n.d(e,{default:()=>a}),window.counter=0;const i=["addedNodes","removedNodes","attributes","characterData","childList"];o.prototype.init=function({observe:t=["addedNodes","attributes"],attributeFilter:e,callback:n}){if(!t||!t.every((t=>i.includes(t))))throw"please enter a valid observe";if(this.observe=t,this.callback=n,e&&e.length)for(let t of e)this._register(t.toLowerCase());else this._register("ALL")},o.prototype._register=function(t){for(let e of this.observe)"childList"!==e?this.callbackMap.has(t)?this.callbackMap.get(t)[e]?this.callbackMap.get(t)[e].push(this.callback):this.callbackMap.get(t)[e]=[this.callback]:this.callbackMap.set(t,{[e]:[this.callback]}):this.callbackMap.get("ALL").childList&&this.callbackMap.get("ALL").childList.push(this.callback)},o.prototype.uninit=function(t){for(let[e,n]of this.callbackMap.entries())n.attributes&&(n.attributes=n.attributes.filter((e=>e!==t))),n.characterData&&(n.characterData=n.characterData.filter((e=>e!==t))),n.addedNodes&&(n.addedNodes=n.addedNodes.filter((e=>e!==t))),n.removedNodes&&(n.removedNodes=n.removedNodes.filter((e=>e!==t))),n.childList&&(n.childList=n.childList.filter((e=>e!==t))),this.callbackMap.set(e,{attributes:n.attributes,characterData:n.characterData,addedNodes:n.addedNodes,removedNodes:n.removedNodes,childList:n.childList})},o.prototype._callback=function(t){for(let e of t)switch(window.counter++,e.type){case"attributes":this._attributeCallback(e);break;case"characterData":this._characterDataCallback(e);break;case"childList":this._childListCallback(e)}},o.prototype.runCallbackGen=function(t){return[function(e,n){let o=this.callbackMap.get(n);if(o&&o[t])for(let n of o[t])n(e)},function(e){for(let n of this.callbackMap.get("ALL")[t])n(e)}]},o.prototype._attributeCallback=function(t){if(!t.target.hasAttributes(t.attributeName))return;t.target.getAttribute(t.attributeName)!==t.oldValue&&(this.runCallbackAtt(t,t.attributeName),this.runCallbackAttAll(t))},o.prototype._characterDataCallback=function(t){if(t.target.data===t.oldValue)return;this.runCallbackCharAll(t);let e=t.target.parentElement;for(let n of e.attributes)this.runCallbackChar(t,n.name)},o.prototype.runCallbackExGen=function(t,e){return function n(o){for(let i of o[e]){if(i.tagName)for(let e of i.attributes){let n=this.callbackMap.get(e.name);if(n&&n[t])for(let e of n[t])e({type:o.type,target:i,[t]:!0})}i.children&&n.call(this,{[e]:i.children})}for(let n of this.callbackMap.get("ALL")[t])for(let i of o[e])i.tagName&&n({type:o.type,target:i,[t]:!0})}},o.prototype._childList=function(t){this.callbackMap.get("ALL").childList.forEach((e=>{e(t)}))},o.prototype._childListCallback=function(t){this._childList(t),this.runCallbackAdd(t),this.runCallbackRemove(t)},o.prototype.setInitialized=function(t,e){t["co_initialized_"+(e=e||"")]=!0},o.prototype.getInitialized=function(t,e){return!!t["co_initialized_"+(e=e||"")]};const a=new o(document.body)},446:function(t,e){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(t){function e(){let e={};return t&&t.config&&(e=t.config),{apiKey:e.apiKey,organization_id:e.organization_Id}}function n(e){let n={};return t&&t.config&&(n=t.config),{apiKey:e.apiKey||n.apiKey,organization_id:e.organization_id||n.organization_Id}}function o(e,n){let o={};t&&t.config&&(o=t.config);let i=e||o.organization_Id,a=n||"";return a?`${i}/${a}`:i}return{getCommonParams:e,getCommonParamsExtend:n,generateSocketClient:o}}(window)}.apply(e,[]))||(t.exports=n)},585:function(t,e,n){var o,i;"undefined"!=typeof self&&self,o=[n(446),n(212)],void 0===(i=function(t,e){return function(t,e,n,o,i){class a{constructor(t="crud"){this.prefix=t||"crud",this.sockets=new Map,this.listeners=new Map,this.messageQueue=new Map,this.saveFileName="",this.globalScope=""}setGlobalScope(t){this.globalScope=`${this.prefix}/${t}`}getGlobalScope(){return this.globalScope}create(t){const{namespace:i,room:a}=t,r=this.getKey(i,a);let c,s=this;if(i&&this.setGlobalScope(i),this.sockets.get(r))return void(c=this.sockets.get(r));let l=e.location.protocol;"about:"===e.location.protocol&&(l=e.parent.location.protocol,t.host||(t.host=e.parent.location.host));let u="http:"===l?"ws":"wss";const d=t.port?t.port:8088;let f=`${u}://${e.location.host}:${d}/${r}`;t.host&&(f=t.host.includes("://")?`${t.host}/${r}`:t.host.includes(":")?`${u}://${t.host}/${r}`:`${u}://${t.host}:${d}/${r}`);try{let t=null;e.localStorage&&(t=e.localStorage.getItem("token")),c=new n(f,t),c.cocreate_connected=!1,this.sockets.set(r,c)}catch(t){return}c.onopen=function(t){c.cocreate_connected||(c.cocreate_connected=!0),(s.messageQueue.get(r)||[]).forEach((t=>c.send(JSON.stringify(t)))),s.messageQueue.set(r,[])},c.onclose=function(e){switch(e.code){case 1e3:break;default:s.destroy(c,r),s.reconnect(c,t)}},c.onerror=function(e){s.destroy(c,r),s.reconnect(c,t)},c.onmessage=function(t){try{if(e.Blob&&t.data instanceof o)return void s.saveFile(t.data);let n=JSON.parse(t.data);if(n.data&&(n.data.uid&&s.__fireEvent(n.data.uid,n.data),n.data.event))return void s.__fireEvent(n.data.event,n.data);n.action;const i=s.listeners.get(n.action);if(!i)return;i.forEach((t=>{t(n.data,r)}))}catch(t){}}}__fireEvent(t,n){if(e.CustomEvent){var o=new e.CustomEvent(t,{detail:n});e.document.dispatchEvent(o)}else process.emit(t,n)}send(t,e,n){const o=i.generate(),a={action:t,data:{...e,uid:o}},r=this.getKeyByRoom(n),c=this.getByRoom(n);return c&&c.cocreate_connected?c.send(JSON.stringify(a)):this.messageQueue.get(r)?this.messageQueue.get(r).push(a):this.messageQueue.set(r,[a]),o}sendFile(t,e){const n=this.getByRoom(e);n&&n.send(t)}listen(t,e){this.listeners.get(t)?this.listeners.get(t).push(e):this.listeners.set(t,[e])}reconnect(t,e){let n=this;setTimeout((function(){n.create(e)}),1e3)}destroy(t,e){t&&(t.onerror=t.onopen=t.onclose=null,t.close(),t=null),this.sockets.get(e)&&this.sockets.delete(e)}destroyByKey(t){let e=this.sockets.get(t);e&&this.destroy(e,t)}getKey(t,e){let n=`${this.prefix}`;return t&&""!=t&&(n+=e&&""!=e?`/${t}/${e}`:`/${t}`),n}getByRoom(t){let e=this.getKeyByRoom(t);return this.sockets.get(e)}getKeyByRoom(t){let e=this.globalScope;return t&&(e=`${this.prefix}/${t}`),e}saveFile(t){if(e.document){const o=this.saveFileName||"downloadFile";var n=e.document.createElement("a");e.document.body.appendChild(n),n.style="display: none";let i=window.URL.createObjectURL(t);n.href=i,n.download=o,n.click(),e.URL.revokeObjectURL(i),this.saveFileName=""}}listenAsync(t){return new Promise(((n,o)=>{let i=setTimeout((()=>{clearTimeout(i),n(null)}),5e3);e.document?e.document.addEventListener(t,(function(t){n(t.detail)}),{once:!0}):process.once(t,(t=>{n(t)}))}))}}return a}(0,window,WebSocket,Blob,e)}.apply(e,o))||(t.exports=i)},212:function(t,e){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(t){const e={attribute:"data-uuid",init:function(e){if(!t.document)return;const n=e||t.document;if(!n.querySelectorAll)return;let o=n.querySelectorAll(`[${this.attribute}]`);const i=this;o.forEach((t=>{const e=parseInt(t.getAttribute(i.attribute))||36,n=i.generate(e);"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value=n:t.innerHTML=n}))},generate:function(e=36){let n=(new Date).getTime(),o=t.performance&&t.performance.now&&1e3*t.performance.now()||0,i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(e<=i.length)i=i.substr(0,e);else{let t=e-i.length,n="-xxxyyxxx",o=Math.floor(t/n.length);for(let t=0;t<o;t++)i+=n;o=t-o*n.length,i+=n.substr(0,o)}return i.replace(/[xy]/g,(function(t){var e=16*Math.random();return n>0?(e=(n+e)%16|0,n=Math.floor(n/16)):(e=(o+e)%16|0,o=Math.floor(o/16)),("x"==t?e:7&e|8).toString(16)}))}};return e.init(),e}(window)}.apply(e,[]))||(t.exports=n)},261:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=u(n(555)),i=u(n(611)),a=u(n(536)),r=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=l(e);if(n&&n.has(t))return n.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if("default"!==a&&Object.prototype.hasOwnProperty.call(t,a)){var r=i?Object.getOwnPropertyDescriptor(t,a):null;r&&(r.get||r.set)?Object.defineProperty(o,a,r):o[a]=t[a]}o.default=t,n&&n.set(t,o);return o}(n(500)),c=n(555),s=u(n(980));function l(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(l=function(t){return t?n:e})(t)}function u(t){return t&&t.__esModule?t:{default:t}}const d={init:function(){let t=document.querySelectorAll(r.containerSelector);for(let e of t){let t=o.default.init(e),{name:n,document_id:a,collection:r}=i.default.getAttr(e);n&&a&&r&&this.read(e,t)}this.__initEvents()},__initEvents:function(){const t=this;document.addEventListener("dndsuccess",(function(t){const{dropedEl:e,dragedEl:n}=t.detail;e.matches(r.containerSelector)&&c.container.get(e).__fireSelectedEvent({selectContainer:e})})),document.addEventListener("input",(function(e){let{name:n,document_id:o,is_realtime:a}=i.default.getAttr(e.target);e.target.matches(r.containerSelector)&&("null"===o?s.default.send({broadcast_sender:!1,rooms:"",emit:{message:"select",data:{name:e.target.getAttribute("name"),values:t.getAllValue(e.target)}}}):a&&t.save(e.target))})),s.default.listen("select",(function(t){let{name:e,values:n}=t,o=document.querySelector(`[name="${e}"]`);if(!o||!c.container.has(o))return;let i=c.container.get(o);i.unselectAll(!1),n.forEach((t=>i.selectOption(t,!0,t,!1)))})),i.default.listen("updateDocument",(function(e){if("cocreate-select"==e.metadata)for(let n of Object.keys(e.data))t.writeSelect(e,n)}))},read:async function(t,e){let n=await i.default.read(t,!1),o=t.getAttribute("name"),a=n.data[o];a=Array.isArray(a)?a:[a],a.forEach((t=>e.selectOption(t,!0,void 0,!1)))},writeSelect:function(t,e){for(let[n,o]of c.container){let{name:a,document_id:r,collection:c,is_listen:s}=i.default.getAttr(n);if(s&&t.collection==c&&t.document_id==r&&e==a){if(t.data[a]){let e=t.data[a];e=Array.isArray(e)?e:[e],e.forEach((t=>o.selectOption(t,!0,void 0,!1)))}else""===t.data[a]&&o.unselectAll();break}}},getAllValue:function(t){return Array.from(t.selectedOptions).map((t=>c.selectedToOption.has(t)?c.selectedToOption.get(t).getAttribute("value"):""))},save:async function(t,e=!0){if(!e)return;let n=this.getAllValue(t);n=n.length<=1?n[0]:n,n=n||"";var o=[{element:t,value:n}];await i.default.save(o)}};a.default.init({name:"CoCreateSelect",callback:t=>{let e=t.querySelectorAll("cocreate-select");o.default.save(e)}});var f=d;e.default=f},500:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.removeMarkup=e.optionTagName=e.optionSelector=e.optionsSelector=e.selectedTagName=e.inputSelector=e.containerSelector=void 0;e.containerSelector="cocreate-select, div.select--field";e.inputSelector="input";e.selectedTagName="selected";e.optionsSelector="*";e.optionSelector="cc-option";e.optionTagName="cc-option";e.removeMarkup='<span class="remove">x</span>'},352:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={};e.default=void 0;var i=l(n(555)),a=l(n(261)),r=l(n(366)),c=(n(500),l(n(536)));n(127);var s=n(555);function l(t){return t&&t.__esModule?t:{default:t}}Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(o,t)||t in e&&e[t]===s[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}}))})),a.default.init(),i.default.adapter=a.default,r.default.init({name:"CoCreateSelect",observe:["addedNodes"],callback:function(t){i.default.init(t.target)}}),c.default.init({name:"CoCreateSelect",selector:"cocreate-select",callback:function(t){a.default.save(t)}});var u=i.default;e.default=u},206:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){Object.defineProperty(window.HTMLElement.prototype,"options",{get:function(){if(t(this)&&o.container.has(this)){return o.container.get(this).getOptions()}}})};var o=n(555);!function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=i(e);if(n&&n.has(t))return n.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var c=a?Object.getOwnPropertyDescriptor(t,r):null;c&&(c.get||c.set)?Object.defineProperty(o,r,c):o[r]=t[r]}o.default=t,n&&n.set(t,o)}(n(500));function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}},555:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.selectedToOption=e.optionToSelected=e.container=void 0;l(n(366));var o=l(n(386)),i=l(n(206)),a=l(n(123)),r=l(n(202)),c=n(648),s=n(500);function l(t){return t&&t.__esModule?t:{default:t}}(0,o.default)((t=>t.matches(`${s.optionsSelector} > ${s.optionSelector}, ${(0,c.addAttribute)(s.containerSelector,">"+s.optionSelector)}`))),(0,i.default)((t=>t.matches(s.containerSelector))),(0,a.default)((t=>t.matches(s.containerSelector))),(0,r.default)((t=>t.matches(s.containerSelector)));const u=new Map;e.container=u;const d=new Map;e.optionToSelected=d;const f=new Map;e.selectedToOption=f;const h=(0,c.parse)(s.removeMarkup);function p(t){this.init(t)}document.addEventListener("click",(function(t){let e=t.target;for(let[t,n]of u)t.contains(e)?e.matches(".remove")?n.unselectOption(e.parentNode):t.classList.contains("open")&&"INPUT"!==e.tagName?n.close():n.open():t.classList.contains("open")&&n.close()})),p.prototype={isMultiple:function(){return!!this.selectContainer.hasAttribute("multiple")},init:function(t){if(!t.matches(s.containerSelector))return!1;if(t.querySelector(s.containerSelector))return!1;if(u.has(t))return;this.selectContainer=t,this.selectedContainer=t.querySelector(`:scope > ${s.selectedTagName}`),this.selectedContainer||(this.selectedContainer=document.createElement(s.selectedTagName),t.prepend(this.selectedContainer)),this.input=t.querySelector(` :scope > ${s.inputSelector}`);t.children[t.children.length-1];for(let t of this.getOptions())t.hasAttribute("selected")&&this.selectOption(t);const e=this;this.input&&this.input.addEventListener("keydown",(function(t){let n=t.keyCode;if(13==n&&t.preventDefault(),13==n&&this.value.length>0)e.selectOption(this.value),this.value="";else if(8==n&&!this.value.length){let t=e.selectedContainer.children;if(!t.length)return;let n=f.get(t[t.length-1]);e.unselectOption(n)}})),this.selectContainer.addEventListener("click",(function(t){let n=t.target;for(;!n.matches(s.optionSelector);)if(n=n.parentElement,!n)return;f.has(n)||d.has(n)||e.selectOption(n,!0)})),u.set(t,this)},open:function(){this.selectContainer.classList.add("open"),this.input&&this.input.focus(),this.selectContainer.dispatchEvent(new CustomEvent("CoCreateSelect-open"))},close:function(){this.input&&(this.input.value=""),this.selectContainer.classList.remove("open"),this.selectContainer.dispatchEvent(new CustomEvent("CoCreateSelect-close"))},getOptions:function(){return this.selectContainer.querySelectorAll(s.optionSelector)},unselectAll:function(t){if(this.selectedContainer.children.length)for(let t of this.selectedContainer.children)f.has(t)&&this.unselectOption(f.get(t),!1);t&&this.__fireSelectedEvent({unselectOption:"all"})},getOptionCounterpart:function(t){return this.selectContainer.querySelector(`${s.optionSelector.trim()}[value="${t}"]`)},isSelected:function(t){return this.selectedContainer.querySelector(`[value="${t}"]`)},validateSelect:function(){if(this.isMultiple()){let t=this.selectContainer.getAttribute("data-limit_option");if(t&&this.selectedContainer.children.length>=t)return}else this.selectedContainer.children.length&&this.unselectAll()},selectOption:function(t,e=!0,n,o=!0){if(!t)return;let i,a;if("string"==typeof t){if(this.isSelected(t))return;this.validateSelect();let r=this.getOptionCounterpart(t);if(r)return this.selectOption(r,e,n,o);i=document.createElement(s.optionTagName),i.setAttribute("value",t),a=t,i.innerText=n||t,d.set(i,i),f.set(i,i)}else{if(a=t.getAttribute("value"),this.isSelected(a))return;this.validateSelect(),i=t.cloneNode(!0),t.setAttribute("selected",""),d.set(t,i),f.set(i,t)}i.appendChild(h.cloneNode(!0)),this.selectedContainer.appendChild(i),o&&this.__fireSelectedEvent({unselectOption:a})},unselectOption:function(t,e=!0){let n;"string"==typeof t?n=t:(f.has(t)&&(t=f.get(t)),t.removeAttribute("selected"),n=t.getAttribute("value"));let o=this.selectedContainer.querySelector(`[value="${n}"]`);o&&(d.delete(t),f.delete(o),o.remove(),e&&this.__fireSelectedEvent({unselectOption:n}))},__fireSelectedEvent:function(t){let e=new CustomEvent("input",{bubbles:!0,detail:t});Object.defineProperty(e,"target",{writable:!1,value:this.selectContainer}),this.selectContainer.dispatchEvent(e)}};var m={init:t=>new p(t)};e.default=m},386:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){Object.defineProperty(window.HTMLElement.prototype,"selected",{get:function(){if(t(this))return this.hasAttribute("selected")},set:function(e){if(t(this)){let t=(0,o.getInstance)(this);e?(this.setAttribute("selected",""),t.selectOption(this,!1)):(this.removeAttribute("selected"),t.unselectOption(this))}}})};var o=n(648)},202:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){Object.defineProperty(window.HTMLElement.prototype,"selectedIndex",{get:function(){if(t(this)){let t=(0,o.getInstance)(this),e=t.selectedContainer.children;if(e.length){let n=i.selectedToOption.get(e[0]);return Array.prototype.indexOf.call(t.getOptions(),n)}return-1}},set:function(e){if(t(this)){let t=(0,o.getInstance)(this);if(isFinite(e)){let n=t.getOptions()[e];t.selectOption(n,!1)}}}})};var o=n(648),i=n(555)},123:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){Object.defineProperty(window.HTMLElement.prototype,"selectedOptions",{get:function(){if(t(this)&&o.container.has(this))return o.container.get(this).selectedContainer.children}})};var o=n(555)},648:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parse=function(t){let e=(new DOMParser).parseFromString(t,"text/html");return e.head.children[0]?e.head.children[0]:e.body.children[0]},e.addAttribute=function(t,e){return t.split(",").map((t=>t.trim()+e)).join(", ")},e.getInstance=function(t){let e=t;for(;e.parentElement&&!e.matches(i.containerSelector);)e=e.parentElement;return o.container.get(e)};var o=n(555),i=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=a(e);if(n&&n.has(t))return n.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var c=i?Object.getOwnPropertyDescriptor(t,r):null;c&&(c.get||c.set)?Object.defineProperty(o,r,c):o[r]=t[r]}o.default=t,n&&n.set(t,o);return o}(n(500));function a(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(a=function(t){return t?n:e})(t)}},127:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>c});var o=n(483),i=n.n(o);const a=n.p+"c74016f7bdacbe9b4922b590aef5df6b.css";var r={injectType:"linkTag",insert:"head"};i()(a,r);const c={}},483:(t,e,n)=>{"use strict";var o,i=(o={},function(t){if(void 0===o[t]){var e=document.querySelector(t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}o[t]=e}return o[t]});t.exports=function(t,e){if((e=e||{}).attributes="object"==typeof e.attributes?e.attributes:{},void 0===e.attributes.nonce){var o=n.nc;o&&(e.attributes.nonce=o)}var a=document.createElement("link");if(a.rel="stylesheet",a.href=t,Object.keys(e.attributes).forEach((function(t){a.setAttribute(t,e.attributes[t])})),"function"==typeof e.insert)e.insert(a);else{var r=i(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(a)}return function(t){"string"==typeof t?a.href=t:a.parentNode.removeChild(a)}}}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var o=e.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})();var o=n(352);return o=o.default})()}));